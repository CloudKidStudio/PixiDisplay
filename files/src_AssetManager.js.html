<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.8.0/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/3.10.1/build/yui/yui-min.js"></script>
	<title>PixiDisplay v0.0.1 API Documentation : src/AssetManager.js</title>  
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><a href="http://github.com/CloudKidStudio/PixiDisplay"><img src="../assets/css/logo.png" title="PixiDisplay"></a></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Documentation for: 0.0.1</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>
		<ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
			<li><a href="#api-modules">Namespaces</a></li>
        </ul>
        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Animator.html">Animator</a></li>
            
                <li><a href="../classes/Animator.AnimTimeline.html">Animator.AnimTimeline</a></li>
            
                <li><a href="../classes/AssetManager.html">AssetManager</a></li>
            
                <li><a href="../classes/Button.html">Button</a></li>
            
                <li><a href="../classes/DragManager.html">DragManager</a></li>
            
                <li><a href="../classes/PixiDisplay.html">PixiDisplay</a></li>
            
                <li><a href="../classes/Positioner.html">Positioner</a></li>
            
                <li><a href="../classes/ScreenSettings.html">ScreenSettings</a></li>
            
                <li><a href="../classes/UIElement.html">UIElement</a></li>
            
                <li><a href="../classes/UIElementSettings.html">UIElementSettings</a></li>
            
                <li><a href="../classes/UIScaler.html">UIScaler</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/cloudkid.html">cloudkid</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
            <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <script>
	var name = src/AssetManager.js      
</script>
<h1 class="file-heading">File:AssetManager.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
*  @module cloudkid
*/
(function() {
	
	&quot;use strict&quot;;

	/**
	*  AssetManager is responsible for managing different resolutions of assets and spritesheets
	*  based on the resolution of the stage. This is a helpful optimization for PIXI because some low-hardware
	*  devices have a problem keeping up with larger images, or just refuse large images entirely.
	*  The AssetManager does not load assets itself, or keep track of what is loaded. It merely assists in 
	*  loading the appropriate assets, as well as easily unloading assets when you are done using them.
	*
	*  @class AssetManager
	*/
	var AssetManager = {};
	
	/** 
	*  Dictionary of scales by asset id. Use this to return your asset to normal size.
	*  Assets are only added to this dictionary after a url has been retrieved with getUrl().
	*  @property {Object} scales
	*  @final
	*  @static
	*/
	AssetManager.scales = null;

	/**
	*  The available size definitions, e.g., {&quot;maxSize&quot;:400, &quot;order&quot;: [&quot;tiny&quot;, &quot;sd&quot;]}
	*  @property {Array} sizes
	*  @private
	*  @static
	*/
	var sizes = null;

	/** 
	*  Dictionary of assets by asset id 
	*  @property {Object} assets
	*  @private
	*  @static
	*/
	var assets = null;

	/** 
	*  The cache of asset url paths
	*  @property {Object} assetUrlCache
	*  @private
	*  @static
	*/
	var assetUrlCache = null;

	/** 
	*  The scaling value for each asset size id, e.g., {&quot;sd&quot; : 1, &quot;tiny&quot; : 2}
	*  @property {Object} scales
	*  @private
	*  @static
	*/
	var scales = null;

	/**
	*  The paths to each resolution folder, e.g., {&quot;sd&quot;:&quot;images/sd/&quot;, &quot;tiny&quot;:&quot;images/tiny/&quot;}
	*  @property {Object} paths
	*  @private
	*  @static
	*/
	var paths = null;

	/**
	*  The collection of perferred size to load
	*  @property {Array} sizeOrder
	*  @private
	*  @static
	*/
	var sizeOrder = null;

	/**
	*  If we should use low hardware, if we know we&#x27;re on a slow device
	*  @property {Boolean} lowHW
	*  @static
	*/
	AssetManager.lowHW = false;
	
	/**
	*  Initialize the asset manager. The asset manager is capable of taking different paths for
	*  each size of image as well as an animation file path for Spine animations. Image assets do not
	*  have to exist in each size. Fonts are marked for unloading purposes. Example config file:
	*
			{
				&quot;path&quot;: {
					&quot;sd&quot;: &quot;images/sd/&quot;,
					&quot;tiny&quot;: &quot;images/tiny/&quot;,
					&quot;anim&quot;: &quot;anims/&quot;
				},
				&quot;scale&quot;: {
					&quot;sd&quot;: 1,
					&quot;tiny&quot;: 2
				},
				&quot;sizing&quot;: [
					{
						&quot;maxSize&quot;: 400,
						&quot;order&quot;: [
							&quot;tiny&quot;,
							&quot;sd&quot;
						]
					},
					{
						&quot;maxSize&quot;: 10000,
						&quot;order&quot;: [
							&quot;sd&quot;,
							&quot;tiny&quot;
						]
					}
				],
				&quot;assets&quot;: {
					&quot;transition&quot;: {
						&quot;src&quot;: &quot;transition.json&quot;,
						&quot;anim&quot;: true
					},
					&quot;TransitionSheet&quot;: {
						&quot;src&quot;: &quot;ui/TransitionSheet.json&quot;,
						&quot;sd&quot;:true,
						&quot;tiny&quot;:true
					},
					&quot;FoodTruck_Title&quot;: {
						&quot;src&quot;: &quot;backgrounds/FoodTruck_Title.jpg&quot;,
						&quot;sd&quot;:true,
						&quot;tiny&quot;:true
					},
					&quot;StartButton&quot;: {
						&quot;src&quot;: &quot;ui/StartButton.png&quot;,
						&quot;sd&quot;:true,
						&quot;tiny&quot;:false
					},
			        &quot;LevelTitleFont&quot;: {
						&quot;src&quot;: &quot;ui/LevelTitleFont.xml&quot;,
						&quot;sd&quot;: true,
						&quot;tiny&quot;: false,
						&quot;isFont&quot;: true
					}
        		}
	*
	*  @method init
	*  @static
	*  @param {Object} config The configuration file which contains keys for &quot;path&quot;, &quot;scale&quot;, &quot;sizing&quot;, &quot;assets&quot;
	*  @param {Number} width The stage width
	*  @param {Number} height The stage height
	*/
	AssetManager.init = function(config, width, height)
	{
		AssetManager.scales = {};
		assets = config.assets;
		assetUrlCache = {};
		paths = config.path;
		sizes = config.sizing;
		scales = config.scale;
		pickScale(width, height);
	};
	
	/**
	*  Get the alias of the preferred size to use
	*  @method getPreferredSize
	*  @static
	*  @return {String} The alias for the preferred size
	*/
	AssetManager.getPreferredSize = function()
	{
		return sizeOrder[0];
	};
	
	/**
	*  Get the preferred scale amount
	*  @method getPreferredScale
	*  @static
	*  @return {Number} The scale amount associated with the preferred size
	*/
	AssetManager.getPreferredScale = function()
	{
		return scales[sizeOrder[0]];
	};
	
	/**
	*  Pick the preferred scale based on the screen resolution
	*  @method pickScale
	*  @private
	*  @static
	*  @param {Number} width The stage width
	*  @param {Number} height The stage height
	*/
	var pickScale = function(width, height)
	{
		var minSize = width &lt; height ? width : height;
		var s;
		for(var i = sizes.length - 1; i &gt;= 0; --i)
		{
			if(sizes[i].maxSize &gt; minSize)
				s = sizes[i];
			else	
				break;
		}
		sizeOrder = s.order;
	};
	
	/**
	*  Get a asset url by asset id
	*  @method getUrl
	*  @static
	*  @param {String} assetId The unique asset id
	*  @return The url of the asset at the appropriate size.
	*/
	AssetManager.getUrl = function(assetId)
	{
		var a = assets[assetId];
		if(!a) return null;
		
		if(assetUrlCache[assetId])
			return assetUrlCache[assetId];
		
		var url;
		if(a.anim)
		{
			url = assetUrlCache[assetId] = paths.anim + a.src;
			return url;
		}

		if(AssetManager.lowHW &amp;&amp; a.lowHW)
		{
			AssetManager.scales[assetId] = scales[a.lowHW];
			url = assetUrlCache[assetId] = paths[a.lowHW] + a.src;
			return url;
		}
		
		for(var i = 0; i &lt; sizeOrder.length; ++i)
		{
			var typeId = sizeOrder[i];
			if(a[typeId])
			{
				AssetManager.scales[assetId] = scales[typeId];
				url = assetUrlCache[assetId] = paths[typeId] + a.src;
				return url;
			}
		}
		return null;
	};
	
	/**
	*  Unload an asset or list of assets.
	*  @method unload
	*  @static
	*  @param {Array|String} assetOrAsset The collection of asset ids or single asset id
	*/
	AssetManager.unload = function(assetOrAssets)
	{
		if(assetOrAssets instanceof Array)
		{
			for(var i = assetOrAssets.length - 1; i &gt;= 0; --i)
			{
				var id = assetOrAssets[i];
				unloadAsset(id);
			}
		}
		else//string
		{
			unloadAsset(assetOrAssets);
		}
	};

	/**
	*  Unload an asset
	*  @method unloadAsset
	*  @static
	*  @private
	*  @param {String} asset The asset id to unload
	*/
	var unloadAsset = function(asset)
	{
		if(!assetUrlCache[asset]) return;//if this doesn&#x27;t exist, then it wasn&#x27;t loaded
		var a = assets[asset];
		if(!a) return;//asset never existed in the master list
		if(a.anim) return;//don&#x27;t unload these, they are pretty small
		if(a.isFont)
		{
			if(PIXI.BitmapText.fonts[asset])
				delete PIXI.BitmapText.fonts[asset];
		}
		//anything else is a texture
		PIXI.Texture.destroyTexture(assetUrlCache[asset]);
		delete AssetManager.scales[asset];
		delete assetUrlCache[asset];
	};

	/**
	*  Assemble a dictionary of Texture arrays representing animations from the PixiJS texture cache.
	*  Example of a getAnims() call:

			var animationDictionary = AssetManager.getAnims(
				{
					&quot;bobIdleHappy&quot;:{&quot;name&quot;:&quot;bob_idle_happy#&quot;, &quot;numberMin&quot;:1, &quot;numberMax&quot;:139},
					&quot;bobIdleNeutral&quot;:{&quot;name&quot;:&quot;bob_idle_neutral#&quot;, &quot;numberMin&quot;:1, &quot;numberMax&quot;:140},
					&quot;bobIdleMad&quot;:{&quot;name&quot;:&quot;bob_idle_mad#&quot;, &quot;numberMin&quot;:1, &quot;numberMax&quot;:140},
					&quot;bobPos&quot;:{&quot;name&quot;:&quot;bob_react_pos#&quot;, &quot;numberMin&quot;:1, &quot;numberMax&quot;:23},
					&quot;bobNeg&quot;:{&quot;name&quot;:&quot;bob_react_neg#&quot;, &quot;numberMin&quot;:1, &quot;numberMax&quot;:31},
				},
				4);

	*  @method getAnims
	*  @static
	*  @param {Object} anims The dictionary of animation assets
	*  @param {int} [maxDigits=4] Maximum number of digits, like 4 for an animation exported as anim_0001.png
	*  @param {Object} [outObj] If already using an return object
	*  @return {Object} An collection of PIXI.Textures for each animation id suitable for use in PIXI.MovieClip
	*/
	AssetManager.getAnims = function(anims, maxDigits, outObj)
	{
		if(maxDigits === undefined)
			maxDigits = 4;
		if(maxDigits &lt; 0)
			maxDigits = 0;
		var zeros = [];
		var compares = [];
		var i, c;
		for(i = 1; i &lt; maxDigits; ++i)
		{
			var s = &quot;&quot;;
			c = 1;
			for(var j = 0; j &lt; i; ++j)
			{
				s += &quot;0&quot;;
				c *= 10;
			}
			zeros.unshift(s);
			compares.push(c);
		}
		var compareLength = compares.length;
		
		var rtnDict = outObj || {};
		var fromFrame = PIXI.Texture.fromFrame;
		var prevTex, len;
		for(var a in anims)
		{
			var data = anims[a];
			var list = [];

			for(i = data.numberMin, len = data.numberMax; i &lt;= len; ++i)
			{
				var num = null;
				for(c = 0; c &lt; compareLength; ++c)
				{
					if(i &lt; compares[c])
					{
						num = zeros[c] + i;
						break;
					}
				}
				if(!num)
					num = i.toString();
				
				//If the texture doesn&#x27;t exist, use the previous texture - this should allow us to use fewer textures
				//that are in fact the same
				var texName = data.name.replace(&quot;#&quot;, num);
				var tex = fromFrame(texName, true);
				if(tex)
					prevTex = tex;
				list.push(prevTex);
			}
			rtnDict[a] = list;
		}
		return rtnDict;
	};
	
	// Assign to the namespace
	namespace(&#x27;cloudkid&#x27;).AssetManager = AssetManager;
	namespace(&#x27;cloudkid.pixi&#x27;).AssetManager = AssetManager;
}());
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>